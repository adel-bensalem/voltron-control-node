- name: Deploy application
  hosts: webservers
  remote_user: web
  become: yes
  roles:
    - deploy-application

- name: Save application location
  hosts: databases
  remote_user: admin
  become: yes
  roles:
    - role: save-application-location
      when: (groups['webservers'] | map('extract', hostvars, 'port_map') | list | first)[application_name] }} is defined
  vars:
    application_port: "{{ (groups['webservers'] | map('extract', hostvars, 'port_map') | list | first)[application_name] }}"
